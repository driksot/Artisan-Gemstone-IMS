<EditForm Model="Order" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <MudCard>
        <MudCardContent>
            <MudGrid>
                <MudItem xs="6">
                    <MudTextField @bind-Value="Order.SONumber" Label="Order Number" Variant="Variant.Outlined" Class="mb-4" />
                </MudItem>
                <ValidationMessage For="@(() => Order.SONumber)" />
                <MudItem xs="6">
                    <MudSelect @bind-Value="Order.Customer" Label="Customer" Class="mb-4">
                        <MudSelectItem Value="Order.Customer">Select a Customer</MudSelectItem>
                        @foreach (var customer in Customers)
                        {
                            <MudSelectItem Value="@customer">@($"{customer.FirstName} {customer.LastName}")</MudSelectItem>
                        }
                    </MudSelect>
                    <ValidationMessage For="@(() => Order.Customer)" />
                </MudItem>
                <MudItem xs="6">
                    <MudSelect @bind-Value="selectedLineItem" Label="Product" Class="mb-4">
                        <MudSelectItem Value="selectedLineItem">Select a Product</MudSelectItem>
                        @foreach (var item in LineItems)
                        {
                            <MudSelectItem Value="@item">@item.Product.Name</MudSelectItem>
                        }
                    </MudSelect>
                    <ValidationMessage For="@(() => selectedLineItem.Product)" />
                </MudItem>
                <MudItem xs="6">
                    <MudNumericField @bind-Value="@selectedLineItem.Quantity" Label="Quantity" Variant="Variant.Text" Min="0" />
                    <ValidationMessage For="@(() => selectedLineItem.Quantity)" />
                </MudItem>
            </MudGrid>
        </MudCardContent>
        <MudCardActions Class="ms-2 mb-4 d-flex justify-end">
            <MudButton Variant="Variant.Filled"
                       StartIcon="@Icons.Material.Filled.Save"
                       Color="Color.Tertiary"
                       @onclick="AddLineItem">
                Add Line Item
            </MudButton>
            <MudButton Variant="Variant.Filled"
                       StartIcon="@Icons.Material.Filled.AddToQueue"
                       Color="Color.Primary"
                       Class="ms-2"
                       ButtonType="MudBlazor.ButtonType.Submit">
                Finalize Order
            </MudButton>
        </MudCardActions>
    </MudCard>
</EditForm>

<br />

@if (Order.LineItems.Count > 0)
{
    <LineItemsTable ItemList="Order.LineItems.ToList()" />
}
